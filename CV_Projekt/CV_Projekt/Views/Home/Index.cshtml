@model HomeViewModel
@{
    ViewData["Title"] = "Home Page";
}

@if(User.Identity.IsAuthenticated)
{
    <h1>Välkommen @Model.LoggedInUser.FirstName!</h1>
}

<br />
<div class="container">
    <div class="row row-cols-md-4 g-4 align-items-stretch">
        @foreach (var user in Model.Users) 
        {
            <div class="col">
                <div class="card h-100 d-flex flex-column">
                    <div class="card-body position-relative flex-grow-1" style="padding-bottom: 70px;">
                        <img src="https://mdbcdn.b-cdn.net/img/Photos/Lightbox/Original/img%20(107).webp" alt="image 1"
                             class="card-img-top w-100 rounded-3">
                        <div class="scrollable-content" style="max-height: 80%; overflow-y: auto; padding-bottom: 10px;">
                        <div class="card-header font-weight-bold bg-dark text-light">@user.FirstName @user.LastName</div>
                        @foreach (var exp in Model.Experiences.Where(e => e.UserId == user.Id))
                        {
                            <div>
                                <br />
                                <div class="card-title fw-bold">@exp.Location</div>
                                @if (exp.Description !=null)
                                {
                                    <p class="card-text fw-light">@exp.Description</p>
                                } else {
                                    <p class="card-text fw-light">Beskrivning av arbetsuppgifter saknas.</p>
                                }   
                            </div>
                            @if (exp is Education edu)
                            {
                                <div class="education-details">
                                    <p class="card-text fw-light">Nivå:@edu.Level</p>
                                    <p class="card-text fw-light">Inriktning: @edu.Program</p>
                                </div>
                            }
                        }
                    
                        <br />
                       
							<div class="card-text"> Färdigheter: </div>
                            
                        @foreach (var cv in Model.Cvs.Where(c => c.OwnerId == user.Id))
                        {
                            @if (cv.Skills.Any())
                            {
                                <ul class="list-unstyled">
                                    @foreach (var skill in cv.Skills) 
                                    {
                                        <li class="card-text fw-light">@skill</li>
                                    }
                                </ul>
                            } else {
                                 <ul class="list-unstyled">
                                    <li class="card-text fw-light">Inga färdigheter listade</li>
                                </ul>
                            }
                            
                                <div class="text-center position-absolute bottom-0 start-0 w-100">
                                    <form asp-controller="Cv" asp-action="IncrementCvViews" method="post">
                                        <input type="hidden" name="id" value="@cv.Id"/>
                                        <button type="submit" class="btn text-light"
                                                style="background-color:#ff6219; margin-bottom:2rem;">
                                                Visa CV
                                        </button>
                                </form>
                            </div>

                            @* <div class="text-center">
                                <a  class="btn btn-primary text-light"
                                style="background-color:#ff6219; margin-bottom:2rem;"
                                asp-controller="Profile"
                                asp-action="Profile"
                                asp-route-id="@cv.Id">
                                Visa CV
                                </a>
                            </div> *@
                        }
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<br />

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-4">
                <div class="card">
                    @if(Model.LatestProject !=null)
                    {
                        @* var projectOwner = Model.Users.FirstOrDefault(u => u.Id == proj.CreatorId); *@
                        <div class="card-body position-relative">
                        <div class="card-header">@Model.LatestProject.Title</div>
                        <div class="card-text">@Model.LatestProject.Description</div>
                        <div class="card-text fw-light">Datum:</div>
                        <div class="card-text fw-light">Start: @Model.LatestProject.StartDate.ToString("yy-MM-dd") Slut: @Model.LatestProject.EndDate.ToString("yy-MM-dd")</div>
                        @* <div class="card-text fw-light">Projektägare:</div> *@
                        @* @if (projectOwner != null) 
                        {
                            <div class="card-text fw-light">@projectOwner.FirstName @projectOwner.LastName</div>
                        } else {
                            <div class="card-text fw-light">Ingen projektägare hittades.</div>
                        } *@
                        </div>
                    }
                    <div class="text-center">
                        <a  class="btn text-light"
                            style="background-color:#ff6219; margin-bottom:2rem;"
                        asp-controller="Project"
                        asp-action="Project"
                        asp-route-id="@Model.LatestProject.Id">
                        Visa detta projekt
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>



<div class="d-flex justify-content-center mt-2">
    @if (User.Identity.IsAuthenticated)
    {
        <a asp-controller="Project" asp-action="Add" class="btn text-light" style="background-color:#ff6219; margin:1rem;">Skapa nytt projekt</a>
    }

    @if(!User.Identity.IsAuthenticated)
    {
        <a asp-controller="Account" asp-action="LogIn" class="btn text-light" style="background-color:#ff6219; margin:1rem;">Logga in</a>
    }
    else
    {
        <form method="post" asp-controller="Account" asp-action="LogOut">
            <button type="submit" class="btn  text-light" style="background-color:#ff6219; margin:1rem;">Logga ut</button>
        </form>
    }
</div>
<div>
    <a  class="btn btn-primary text-light"
    style="background-color:#ff6219; margin-bottom:2rem;"
    asp-controller="Message"
    asp-action="ChatList"
    asp-route-id="1">
        Visa Meddelanden
    </a>
</div>
<div>
    <a class="btn btn-primary text-light"
       style="background-color:#ff6219; margin-bottom:2rem;"
       asp-controller="Project"
       asp-action="ShowProjectsView">
        Visa Alla Projekt
    </a>
</div>
